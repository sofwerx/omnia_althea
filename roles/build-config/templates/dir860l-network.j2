# Port numbers for this device start at 0 with the WAN port and count going up
# from there, so the port labeled '1' will be reffered to as '4' in this switch config

config interface 'loopback'
	option ifname 'lo'
	option proto 'static'
	option ipaddr '127.0.0.1'
	option netmask '255.0.0.0'

config globals 'globals'
	option ula_prefix 'fdb3:825a:9f14::/48'

config interface 'lan'
	option type 'bridge'
	option ifname 'eth0.5'
	option proto 'static'
	option ipaddr '192.168.1.1'
	option netmask '255.255.255.0'
	option ip6assign '60'

config device 'lan_dev'
	option name 'eth0.5'
	option macaddr '54:b8:0a:a6:3e:1c'


{% if gateway %}
config interface 'backhaul'
        option ifname 'eth0.1'
        option proto 'dhcp'

config interface 'backhaul6'
        option ifname 'eth0.1'
        option proto 'dhcp6'

{% for interface in listen_interfaces_gateway %}
config interface 'rita_{{interface | replace(".","")}}'
        option ifname {{interface}}
        option proto static
{% endfor %}
{% else %}
{% for interface in listen_interfaces_client %}
config interface 'rita_{{interface | replace(".","")}}'
        option ifname {{interface}}
        option proto static
{% endfor %}
{% endif %}

config switch
	option name 'switch0'
	option reset '1'
	option enable_vlan '1'

{% if gateway or extender %}
config switch_vlan
	option device 'switch0'
	option vlan '2'
	option ports '1 6t'
config switch_vlan
	option device 'switch0'
	option vlan '3'
	option ports '2 6t'
config switch_vlan
	option device 'switch0'
	option vlan '4'
	option ports '3 6t'
config switch_vlan
	option device 'switch0'
	option vlan '5'
	option ports '4 6t'
{% else %}
config switch_vlan
	option device 'switch0'
	option vlan '5'
	option ports '2 3 4 6t'
config switch_vlan
	option device 'switch0'
	option vlan '2'
	option ports '1 6t'
{% endif %}

# WAN port
config switch_vlan
	option device 'switch0'
	option vlan '1'
	option ports '0 6t'
<<<<<<< HEAD

config 'route' 'defaultOverWg'
        option 'interface' 'wgExit'
        option 'target' '0.0.0.0'
        option 'netmask' '0.0.0.0'
        option 'gateway' '{{wg_internal_gateway}}'

config interface 'wgExit'
        option proto 'wireguard'
        option mtu '1340'
        option private_key 'placeholder'
        list addresses '1.1.1.1'
        option listen_port '{{wg_port}}'

config wireguard_wgExit
        option public_key '{{wg_server_public_key}}'
        list allowed_ips '0.0.0.0/0'
{% if gateway %} #Gateways can exit directly
        option endpoint_host '{{wg_server}}'
        option endpoint_port '{{wg_port}}'
{% else %}
# TODO: fix init script for openwrt wireguard to allow ipv6 ip's
#        option endpoint_host '{{wg_server}}'
#        option endpoint_port '{{wg_port}}'
{% endif %}
        option persistent_keepalive '25'

{% if gateway %}
config interface 'wgBridge'
        option proto 'wireguard'
        option private_key 'placeholder'
        option listen_port '{{gateway_port}}'
        option addresses 'fe80::1/64'

config wireguard_wgBridge
        option public_key '{{wg_server_public_key}}'
        list allowed_ips '::/0'
        option endpoint_host '{{wg_server}}'
        option endpoint_port '{{gateway_port}}'
        option persistent_keepalive '25'
{% endif %}
=======
>>>>>>> 6fa302ffbc193f5e837aa3f1d0b51197fb97227a
