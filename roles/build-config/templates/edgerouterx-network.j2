config interface 'loopback'
        option ifname 'lo'
        option proto 'static'
        option ipaddr '127.0.0.1'
        option netmask '255.0.0.0'

config globals 'globals'
        option ula_prefix 'fdb2:4a8f:fc1e::/48'


{% if gateway %}
config interface 'backhaul'
        option ifname 'eth0.1'
        option proto 'dhcp'
        option ip6assign '60'

config device 'backhaul_dev'
        option name 'eth0.1'
        option macaddr '78:8a:20:bb:7e:4e'

{% endif %}

config interface 'lan'
        option type 'bridge'
        option ifname 'eth0.5'
        option proto 'static'
        option ipaddr '192.168.1.1'
        option netmask '255.255.255.0'
        option ip6assign '60'

config device 'lan_dev'
        option name 'eth0.5'
        option macaddr '78:8a:20:bb:7e:52'

# Due to the device requirements the loop is pretty
# pointless, #TODO figure out how to generalize
# or just admit defeat and hardcode
{% if gateway %}
{% for interface in listen_interfaces_gateway %}
config interface 'rita_{{interface | replace(".","")}}'
        option ifname {{interface}}
        option proto static
{% endfor %}
config device 'ritad_eth02_dev'
        option name 'eth0.2'
        option macaddr '78:8a:20:bb:7e:4f'
config device 'ritad_eth03_dev'
        option name 'eth0.3'
        option macaddr '78:8a:20:bb:7e:50'
config device 'ritad_eth04_dev'
        option name 'eth0.4'
        option macaddr '78:8a:20:bb:7e:51'

{% else %}
{% for interface in listen_interfaces_client %}
config interface 'rita_{{interface | replace(".","")}}'
        option ifname {{interface}}
        option proto static
        option ip6addr fde6::1
{% endfor %}
config device 'ritad_eth01_dev'
        option name 'eth0.1'
        option macaddr '78:8a:20:bb:7e:4e'
config device 'ritad_eth02_dev'
        option name 'eth0.2'
        option macaddr '78:8a:20:bb:7e:4f'
config device 'ritad_eth03_dev'
        option name 'eth0.3'
        option macaddr '78:8a:20:bb:7e:50'
config device 'ritad_eth04_dev'
        option name 'eth0.4'
        option macaddr '78:8a:20:bb:7e:51'

{% endif %}


config switch
        option name 'switch0'
        option reset '1'
        option enable_vlan '1'

config switch_vlan
        option device 'switch0'
        option vlan '1'
        option ports '0 6t'

config switch_vlan
        option device 'switch0'
        option vlan '2'
        option ports '1 6t'

config switch_vlan
        option device 'switch0'
        option vlan '3'
        option ports '2 6t'

config switch_vlan
        option device 'switch0'
        option vlan '4'
        option ports '3 6t'

config switch_vlan
        option device 'switch0'
        option vlan '5'
        option ports '4 6t'
<<<<<<< HEAD

config 'route' 'defaultOverWg'
        option 'interface' 'wgExit'
        option 'target' '0.0.0.0'
        option 'netmask' '0.0.0.0'
        option 'gateway' '{{wg_internal_gateway}}'

config interface 'wgExit'
        option proto 'wireguard'
        option mtu '1340'
        option private_key 'placeholder'
        list addresses '1.1.1.1'
        option listen_port '{{wg_port}}'


config wireguard_wgExit
        option public_key '{{wg_server_public_key}}'
        list allowed_ips '0.0.0.0/0'
{% if gateway %} #Gateways can exit directly
        option endpoint_host '{{wg_server}}'
        option endpoint_port '{{wg_port}}'
{% else %}
# TODO: fix init script for openwrt wireguard to allow ipv6 ip's
#        option endpoint_host '{{wg_server}}'
#        option endpoint_port '{{wg_port}}'
{% endif %}
        option persistent_keepalive '25'

{% if gateway %}
config interface 'wgBridge'
        option proto 'wireguard'
        option private_key 'placeholder'
        option listen_port '{{gateway_port}}'
        option addresses 'fe80::1/64'

config wireguard_wgBridge
        option public_key '{{wg_server_public_key}}'
        list allowed_ips '::/0'
        option endpoint_host '{{wg_server}}'
        option endpoint_port '{{gateway_port}}'
        option persistent_keepalive '25'
{% endif %}
=======
>>>>>>> 6fa302ffbc193f5e837aa3f1d0b51197fb97227a
